---
title: "Fusion release document"
author: "Guillaume Kugener"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('~/Documents/Analysis/RScripts/load_libraries_and_annotations.R')
```

# Overview

This document contains the code used to generate the unfiltered and filtered versions of the fusion datasets for the release. The bottom of the document also contains some comparisons between the release fusion dataset, CCLE2 fusion calls, and the translocation data from CCLE2.

```{r}
release <- '19Q2'
directory_to_save_files_to <- '/Volumes/xchip_datasci/gkugener/DepMap_Omics/RNAseq/Fusions/data/'
filtepath = 
# Make directory for release if it does not exist
dir.create(paste0(directory_to_save_files_to), showWarnings = T)
dir.create(paste0(directory_to_save_files_to, release), showWarnings = T)

# Path to fusion calls from FireCloud

```

## Generate filtered fusion table

Release: `r release`

We want to apply filters to the fusion table to reduce the number of artifacts in the dataset. Specifically, we filter the following:

* Remove fusions involving mitochondrial chromosomes, or HLA genes, or immunoglobulin genes
* Remove red herring fusions (from STAR-Fusion annotations column)
* Remove recurrent in CCLE (>= 25 samples)
* Remove fusion with (SpliceType=" INCL_NON_REF_SPLICE" and LargeAnchorSupport="No" and FFPM < 0.1)
* Remove fusions with FFPM < 0.05 (STAR-Fusion suggests using 0.1, but looking at the translocation data, this looks like it might be too aggressive)

```{r eval=TRUE}
filtered_fusion <- filter_fusion()
```

Dimensions of unfiltered dataset: `r dim(tentative_new_release_unfiltered_fusions)`
Dimensions of the filtered dataset: `r dim(tentative_new_release_filtered_fusions)`

```{r}
# Save the files (to be uploaded to taiga)
write.table(
  tentative_new_release_unfiltered_fusions,
  file = paste0('~/Documents/Analysis/DepMap_omics/FC_PostProcessing/RNAseq/Fusions/data/', release, '/', release, '_unfiltered_fusions.tsv'),
  sep = '\t', quote = F, row.names = F
)
write.table(
  tentative_new_release_filtered_fusions,
  file = paste0('~/Documents/Analysis/DepMap_omics/FC_PostProcessing/RNAseq/Fusions/data/', release, '/', release, '_filtered_fusions.tsv'),
  sep = '\t', quote = F, row.names = F
)
```

